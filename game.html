<!doctype html>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto:700&display=swap" rel="stylesheet">
    <meta charset="utf-8">
    <title>COMP 20 - FINAL PROJECT</title>
    <style type="text/css">
      body, html {
        background-color: #454545;
        color: #FFF;
        font-family: 'Roboto', sans-serif;
        cursor: default;
        padding: 0px;
        margin: 0px;
      }
      .navBar {
        position: fixed;
        top: 0px;
        background-color: #595959;
        width: 100%;
        margin: 0px;
        padding: 10px;
        text-align: center;
      }
      .container {
        position: absolute;
        left: 50%;
        margin-left: -500px;
        top: 150px;
        width: 1000px;
        text-align: center;
      }
      #wordsContainer {
        position: relative;
        margin-bottom: 100px;
        margin-top: 100px;
      }
      .word {
        position: relative;
        display: inline;
        margin: 0px 10px;
        text-decoration: none;
        text-align: center;
        border-bottom: solid 7px #ad42ff;
      }
      a {
        color: #FFF;
        text-decoration: none;
        font-size: 45px;
      }
      h2 {
        font-size: 40px;
      }
      h3 {
        font-size: 30px;
      }
      h4 {
        font-size: 23px;
      }
      h5 {
        font-size: 17px;
      }
      #scoreContainer {
        text-align: center;
        position: absolute;
        width: 200px;
        top: 225px;
        left: -50px;
        background-color:
      }
      #livesContainer {
        text-align: center;
        position: absolute;
        width: 200px;
        top: 225px;
        right: -50px;;
      }
      #answersContainer {
        position: relative;
        margin-bottom: 100px;
      }
      .answerButton {
        width: 15%;
        color: #FFF;
        position: relative;
        background-color: #1f1f1f;
        border: solid 3px #1f1f1f;
        border-radius: 20px;
        padding: 16px 24px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16pt;
        margin: 0px 10px;
      }
      .answerButton_hover:hover {
        background: #808080;
        border: solid 3px #808080;
        border-radius: 20px;
        color: #f7f7f7;
        outline: none;
        cursor: pointer;
      }
      .answerButton:focus {
        outline: 0;
      }
      #currentScore {
        text-decoration: none;
      }
      #lives {
        text-decoration: none;
      }
      #feedback {
        font-family: 'Roboto', sans-serif;
        position: absolute;
        left: 50%;
        margin-left: -450px;
        top: 50px;
        width: 900px;
        text-align: center;
      }
      .wrongButton {
        background-color: #d90024;
        border-color: #d90024;
      }
      .correctButton {
        background-color: #14b000;
        border-color: #14b000;
      }
      .timerContainer {
        position: absolute;
        left: 50%;
        width: 600px;
        margin-left: -300px;
        top: 340px;
      }
      progress {
        width: 100%;
        height: 20px;
        color: #ad42ff;
        border-radius: 5px;
        -webkit-appearance: progress-bar;
      }
      progress::-webkit-progress-bar {
        width: 100%;
        height: 20px;
        border-radius: 5px;
        background-color: #5e5e5e;
      }
      progress::-webkit-progress-value {
        width: 100%;
        height: 20px;
        background-color: #ad42ff;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <nav class="navBar"><a href="index.html">Onym Words</a></nav>
    <div class="timerContainer">
      <progress class="time" id="time" value="10" max="10" min="0"></progress>
    </div>
    <div class="container" id="container">
    <div class="container2" id="container2">
      <div id="wordsContainer">
        <h2><div class="word" id="word1">word1</div> and <div class="word" id="word2">word2</div> are: </h2>
      </div>
      <div id="answersContainer">
        <input class="answerButton answerButton_hover" type="button" value="Synonyms" id="synonyms" onclick="return answer(this.id);">
        <input class="answerButton answerButton_hover" type="button" value="Antonyms" id="antonyms" onclick="return answer(this.id);">
        <input class="answerButton answerButton_hover" type="button" value="Neither" id="neither" onclick="return answer(this.id);">
      </div>
      <div id="scoreContainer">
        <h3 id="scoreLine">Score: <br><ins id="currentScore">0</ins></h3>
      </div>
      <div id="livesContainer">
        <h3 id="livesLine">Lives: <br><ins id="lives">3</ins></h3>
      </div>
    </div>
    </div>
    <h2 id="feedback" style="height: 50px; font-size: 80px;"></h2>

    <script language="javascript" type="text/javascript">

    var words = ["POLITE","BEAUTIFUL", "GORGEOUS", "HAPPY", "SAD", "UGLY",
                "UNHAPPY", "UNATTRACTIVE", "ATTRACTIVE", "HANDSOME", "CUTE",
                "SMART", "STUPID", "BIG", "TINY", "HUGE", "LUCKY", "UNLUCKY",
                "FUN", "FUNNY", "SCARY", "DUMB", "DIFFICULT", "EASY", "PLEASANT",
                "EXCITED", "PATHETIC", "HONORABLE", "INCORRECT", "MANY",
                "WORSE", "SUPERIOR", "ELEGANT", "SIMPLE", "LOUD", "QUIET", "PROPER",
                "SECURE", "HORRIBLE", "DISGUSTING", "SMOOTH", "HEALTHY", "RESPONSIBLE",
              "ACTIVE", "PASSIVE", "TERRIBLE", "STIFF", "FAT", "SKINNY", "BORING"];
    var usedWords = [];
    var word1 = document.getElementById("word1");
    var word2 = document.getElementById("word2");
    var ansId;
    var currScore = 0;
    var finalScore = 0;
    var currLives;
    var synDisplay = document.getElementById("synonyms");
    var antDisplay = document.getElementById("antonyms");
    var neiDisplay = document.getElementById("neither");
    var progressBar = document.getElementById("time");
    var feedbackDisplay = document.getElementById("feedback");
    var w1choose = "";
    var w2choose = "";
    var correctAnswer = "NEITHER";
    var intervalTimer;

    function setWords() {
        document.getElementById("feedback").innerHTML = "";
        do {
          $.ajax({
            type: "GET",
            url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+words[Math.floor(Math.random() * words.length)]+"?key=22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
            dataType: 'json',
            success: function(data) {
              w1choose = data[0].meta.syns[0][Math.floor(Math.random() * data[0].meta.syns[0].length)].toUpperCase();
            },
            async: false
          });
        } while (usedWords.includes(w1choose));
        var pick = Math.floor(Math.random() * 11) + 1;
        do {
          choosew2(w1choose, pick);
        } while (usedWords.includes(w2choose));
        usedWords.push(w1choose, w2choose);
        word1.innerHTML = w1choose;
        word2.innerHTML = w2choose;
        console.log("correctAnswer: " + correctAnswer);
        timing();
      }

      function choosew2(w1choose, pick) {
        do {
          if (pick < 5) {                                                      // 4/11 chance of synonym
            if (synsExist(w1choose)) {
              w2choose = pickSynonym(w1choose);
              correctAnswer = "SYNONYMS";
            } else {
              pick = 3;
            }
          }
          if (pick >= 5 && pick < 9) {                                         // 4/11 chance of antonym
            if (antsExist(w1choose)) {
              w2choose = pickAntonym(w1choose);
              correctAnswer = "ANTONYMS";
            } else {
              pick = 3;
            }
          }
          if (pick >= 9) {                                                     // 3/11 chance of neither (less meaningful and slightly slower to run)
            correctAnswer = "NEITHER";
            w2choose = pickRandom();
            if (areSynonyms(w1choose, w2choose)) {
              correctAnswer = "SYNONYMS";
            }
            if (areAntonyms(w1choose, w2choose)) {
              correctAnswer = "ANTONYMS";
            }
          }
          if ((w2choose == "undefined") || (w2choose == "")) {
            w2choose = pickRandom(w1choose);
          }
        } while (w1choose == w2choose);
      }

      function synsExist(w) {
        var b = false;
        $.ajax({
          type: "GET",
          url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+w+"?key="+"22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
          dataType: 'json',
          success: function(data) {
            if (data[0].meta.hasOwnProperty("syns")) {
              if (data[0].meta.syns.status === undefined) {
                if (data[0].meta.syns.length > 0) {
                  b = true;
                }
              }
            }
          },
          async: false
        });
        return b;
      }

      function antsExist(w) {
        var b = false;
        $.ajax({
          type: "GET",
          url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+w+"?key="+"22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
          dataType: 'json',
          success: function(data) {
            if (data[0].meta.hasOwnProperty("ants")) {
              if (data[0].meta.ants.status === undefined) {
                if (data[0].meta.ants.length > 0) {
                  b = true;
                }
              }
            }
          },
          async: false
        });
        return b;
      }

      function pickSynonym(w) {
        var s;
        $.ajax({
          type: "GET",
          url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+w+"?key=22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
          dataType: 'json',
          success: function(data) {
            outerArray = data[0].meta.syns[Math.floor(Math.random() * data[0].meta.syns.length)];
            s = outerArray[Math.floor(Math.random() * outerArray.length)];
            //s = JSON.stringify(data[0].meta.syns[0][Math.floor(Math.random() * data[0].meta.syns[0].length)]);
          },
          async: false
        });
        return s.toUpperCase().replace(/\"/g, "");
      }

      function pickAntonym(w) {
        var a;
        $.ajax({
          type: "GET",
          url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+w+"?key=22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
          dataType: 'json',
          success: function(data) {
            outerArray = data[0].meta.ants[Math.floor(Math.random() * data[0].meta.ants.length)];
            a = outerArray[Math.floor(Math.random() * outerArray.length)];
            //s = JSON.stringify(data[0].meta.syns[0][Math.floor(Math.random() * data[0].meta.syns[0].length)]);
          },
          async: false
        });
        return a.toUpperCase().replace(/\"/g, "");
      }

      function pickRandom() {
        var n;
        $.ajax({
          type: "GET",
          url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+words[Math.floor(Math.random() * words.length)]+"?key=22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
          dataType: 'json',
          success: function(data) {
            which = Math.floor(Math.random() * 2) + 1;
            if (which == 1) {
              outerArray = data[0].meta.syns[Math.floor(Math.random() * data[0].meta.syns.length)];
              n = outerArray[Math.floor(Math.random() * outerArray.length)];
            }
            else {
              outerArray = data[0].meta.ants[Math.floor(Math.random() * data[0].meta.ants.length)];
              n = outerArray[Math.floor(Math.random() * outerArray.length)];
            }
          },
          async: false
        });
        return n.toUpperCase().replace(/\"/g, "");
      }

    setWords();

    function answer(ans) {
      console.log(usedWords);
      ansId = ans;
      var done = false;
      $("#"+correctAnswer.toLowerCase()).addClass("correctButton");
      synDisplay.disabled = antDisplay.disabled = neiDisplay.disabled = true;
      $("#synonyms").removeClass("answerButton_hover");
      $("#antonyms").removeClass("answerButton_hover");
      $("#neither").removeClass("answerButton_hover");
      if (ansId == "timesUp") {
        currLives = parseInt(document.getElementById("lives").textContent);
        currLives--;
        if (currLives > 0) {
          $('#feedback').html('⏳❌').show().delay(700).fadeOut(350);
          document.getElementById("lives").innerHTML = currLives;
          $.when($('#feedback').show()).then(function() { next(); });
        }
        else {
          feedbackDisplay.style.color = "#d90024";
          $('#feedback').html('❌ GAME OVER ❌').show();
          document.getElementById("lives").innerHTML = 0;
          finalScore = parseInt(document.getElementById("currentScore").textContent);
          $.when($('#feedback').show()).then(gameEnd());
        }
      }
      else if (ansId == correctAnswer.toLowerCase()) {
        var gainedScore = Math.round(progressBar.value * 100);
        $("#" + ansId).addClass("correctButton");
        feedbackDisplay.style.color = "#14b000";
        $('#feedback').html("+" + gainedScore).show().delay(700).fadeOut(350);
        currScore = parseInt(document.getElementById("currentScore").textContent);
        currScore += gainedScore;
        var newScore = (currScore).toString();
        document.getElementById("currentScore").innerHTML = newScore;
        $.when($('#feedback').show()).then(function() { next(); });
      }
      else {
        $("#" + ansId).addClass("wrongButton");
        currLives = parseInt(document.getElementById("lives").textContent);
        currLives--;
        if (currLives > 0) {
          $('#feedback').html('👎❌').show().delay(700).fadeOut(350);                                           // More than 0 lives, keep playing
          document.getElementById("lives").innerHTML = currLives;
          $.when($('#feedback').show()).then(function() { next(); });
        }
        else {
          feedbackDisplay.style.color = "#d90024";
          $('#feedback').html('❌ GAME OVER ❌').show();
          document.getElementById("lives").innerHTML = 0;
          finalScore = parseInt(document.getElementById("currentScore").textContent);
          $.when($('#feedback').show()).then(gameEnd());
        }
      }
    }

    function next() {
      $("#" + ansId).removeClass("wrongButton");                                 // Hide feedback
      $("#" + ansId).removeClass("correctButton");                               // Hide feedback
      $("#synonyms").addClass("answerButton_hover");                         // Allow hover on answerButtons
      $("#antonyms").addClass("answerButton_hover");                         // Allow hover on answerButtons
      $("#neither").addClass("answerButton_hover");                          // Allow hover on answerButtons
      synDisplay.disabled = antDisplay.disabled = neiDisplay.disabled = false;                                           // answerButtons clickable again
      $("#" + correctAnswer.toLowerCase()).removeClass("correctButton");
      setWords();
    }

    function areAntonyms(w1, w2) {
      var isAntonym = false;
      w1 = w1.toLowerCase();
      w2 = w2.toLowerCase();
      $.ajax({
        type: "GET",
        url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+w1+"?key=22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
        dataType: 'json',
        success: function(data) {
          if (data[0].meta.ants.length > 0) {
            for (i = 0; i < data[0].meta.ants.length; i++) {
              if (data[0].meta.ants[i].includes(w2)) {
                isAntonym = true;
              }
            }
          }
        },
        async: false
      });
      $.ajax({
        type: "GET",
        url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+w2+"?key=22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
        dataType: 'json',
        success: function(data) {
          if (data[0].meta.ants.length > 0) {
            for (i = 0; i < data[0].meta.ants.length; i++) {
              if (data[0].meta.ants[i].includes(w1)) {
                isAntonym = true;
              }
            }
          }
        },
        async: false
      });
      return isAntonym;
    }

    function areSynonyms(w1, w2) {
      var isSynonym = false;
      w1 = w1.toLowerCase();
      w2 = w2.toLowerCase();
      $.ajax({
        type: "GET",
        url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+w1+"?key=22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
        dataType: 'json',
        success: function(data) {
          if (data[0].meta.syns.length > 0) {
            for (i = 0; i < data[0].meta.syns.length; i++) {
              if (data[0].meta.syns[i].includes(w2)) {
                isSynonym = true;
              }
            }
          }
        },
        async: false
      });
      $.ajax({
        type: "GET",
        url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+w2+"?key=22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
        dataType: 'json',
        success: function(data) {
          if (data[0].meta.syns.length > 0) {
            for (i = 0; i < data[0].meta.syns.length; i++) {
              if (data[0].meta.syns[i].includes(w1)) {
                isSynonym = true;
              }
            }
          }
        },
        async: false
      });
      return isSynonym;
    }

    function timing() {
      var timeLeft = 10;
      progressBar.setAttribute("min", "0");
      intervalTimer = setInterval(function() {
        progressBar.value = timeLeft;
        timeLeft -= 0.01;
        if (timeLeft <= 0) {
          clearInterval(intervalTimer);
          answer("timesUp");
        }
      }, 10);
      $(".answerButton").click(
        function() {
          clearInterval(intervalTimer);
        }
      )
    }

    function gameEnd() {
      localStorage.setItem("finalScore", finalScore);
      localStorage.setItem("usedWords", usedWords);
      setTimeout(function() { window.location.href = "gameEnd.html" }, 2750);
    }

    </script>
  </body>
</html>
